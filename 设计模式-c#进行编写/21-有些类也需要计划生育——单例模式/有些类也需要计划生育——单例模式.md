# 有些类也需要计划生育——单例模式

> 定义：保证一个类仅有一个实例，并提供一个访问它的全局访问

![单例模式结构图](picture/第二十一章/单例模式结构图.png)

在.NET中我们可以一直创建某个同一功能的窗体，但事实上我们只需要创建一个

![窗体不用单例时](picture/第二十一章/窗体不用单例时.png)

为了解决上图出现的问题： **我们需要让类自身负责保护它的唯一实例。这个类可以保证没有其他实例可以被创建，并且它可以提供一个访问该实例的方法**

**多线程时的单例**

*在多线程程序中还是可能创建多个实例的*

我们可以增加一把锁，==lock是确保当一个线程位于代码的临界区时，另一个线程不进入临界区。如果其他线程试图进入锁定的代码，则它将一直阻止，直到该对象被释放==

**双重锁定**

![多线程单例模式](picture/第二十一章/多线程单例模式.png)

**静态初始化**：C#与公共语言运行库提供了一种‘静态初始化’方法，这种方法不需要开发人员显式地编写线程安全代码，即可解决多线程环境下它是不安全的问题![.NET中提供的安全写法](picture/第二十一章/.NET中提供的安全写法.png)

==这里将instance标记为readonly==，意味着只能在静态初始化期间或者在类构造函数中分配变量。

这种被形象的称为==饿汉式单例类== ，**静态初始化方式是在自己被加载时就将自己实例化**

原先的普通单例处理方式称为==懒汉式单例类==， **第一次被引用时，才会将自己实例化**